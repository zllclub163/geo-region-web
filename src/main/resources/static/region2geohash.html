<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Leaflet.ShowHideLayerGroup</title>
    <meta charset="utf-8"/>
    <!-- 引入leafletapi -->
    <link rel="stylesheet" href="./lib/leaflet/leaflet.css"/>
    <link rel="stylesheet" href="./lib/leaflet/nprogress.css"/>
    <script src="./lib/leaflet/leaflet.js"></script>

    <!--引入proj4，百度地图用-->
    <script src="./lib/leaflet/plugins/proj4.js"></script>
    <script src="./lib/leaflet/plugins/proj4leaflet.min.js"></script>
    <script src="./lib/leaflet/plugins/jquery.min.js"></script>

    <!-- 引入互联网地图插件 -->
    <script src="./lib/leaflet/plugins/leaflet.ChineseTmsProviders.js"></script>
    <script src="./lib/leaflet/plugins/leaflet-editable-polyline.js"></script>
    <script src="./lib/leaflet/plugins/nprogress.js"></script>
    <!--
        互联网地图纠偏插件
        需配合 leaflet.ChineseTmsProviders.js 插件使用
        无需js代码，引用后自动纠偏
        纠偏后的坐标为WGS84
    -->
<!--    <script src="./lib/leaflet/plugins/leaflet.mapCorrection.min.js"></script>-->

    <style>
        body {
            margin: 0;
        }

        .map {
            position: absolute;
            height: 100%;
            right: 0;
            left: 0;
        }

        .menuBar {
            position: fixed;
            right: 2px;
            text-align: right;
            top: 10px;
            margin-right: 10px;
            padding-right: 5px;
            width: 150px;
            z-index: 999;
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0);
        }

    </style>
</head>

<body>
<div class="map" id="map"></div>
<div class="menuBar">
    <select id="select" style="width: 100px">
        <option value="1">高德地图</option>
        <option value="2">谷歌地图</option>
        <option value="4">谷歌卫星</option>
        <option value="3">OSM地图</option>
        <option value="5">等高线图</option>
    </select>
    <br>
    <button type="button" class="distance" id="juliMeasure" style="margin-top: 5px;width: 47px">测距</button>
    <button type="button" id="clearMeasure" style="width: 47px">清除</button>
    <br>
    <button type="button" onclick="alert('拖动点标记以移动它\n'+
'右键单击点标记以删除该点\n'+
'拖动中间点标记以在两个现有点之间创建新点\n'+
'右键单击中间点标记以拆分点\n'+
'单击第一个或最后一个点以添加新的第一个/最后一个点')" style="margin-top: 5px;width: 99px;">帮助❓
    </button>
    <button type="button" onclick="reflushFence()" style="margin-top: 5px;width: 99px;">显示地图围栏</button>

    <textarea id="fenceSetting" style="margin-top: 5px;width: 94px" placeholder="围栏坐标">121.295578 31.501753,121.296421 31.500664,121.297264 31.501107,121.297482 31.500817,121.297828 31.500949,121.298013 31.500584,121.296797 31.49997,121.2963 31.500616,121.295668 31.500352,121.296545 31.498676,121.297386 31.498787,121.297689 31.498841,121.298369 31.49905,121.298581 31.49902,121.298697 31.498885,121.298926 31.49848,121.299259 31.498249,121.299604 31.498069,121.299854 31.497941,121.300147 31.496734,121.300313 31.496464,121.300785 31.496086,121.301159 31.495821,121.3013 31.495564,121.301553 31.494963,121.301271 31.494773,121.301499 31.49446,121.302031 31.494895,121.302247 31.494712,121.302496 31.494633,121.303754 31.494435,121.304792 31.494507,121.305967 31.491651,121.304313 31.491097,121.304214 31.491027,121.30412 31.490862,121.304082 31.490745,121.304153 31.490473,121.304377 31.490048,121.304682 31.489522,121.304833 31.489468,121.305041 31.48949,121.3054 31.489643,121.305655 31.489674,121.305728 31.489188,121.306038 31.488564,121.306085 31.488264,121.305905 31.487482,121.305905 31.487289,121.305971 31.487053,121.306118 31.48689,121.306739 31.486777,121.306933 31.486636,121.307488 31.485775,121.307631 31.485453,121.307656 31.485212,121.307601 31.484738,121.307494 31.48441,121.307459 31.484223,121.307551 31.483996,121.307753 31.483704,121.308112 31.483344,121.308486 31.482996,121.308687 31.482587,121.30878 31.482462,121.30892 31.482374,121.309164 31.482319,121.309964 31.482292,121.310307 31.482368,121.310597 31.482468,121.311339 31.48307,121.311511 31.483175,121.311632 31.483192,121.311764 31.483169,121.311887 31.483108,121.312132 31.482702,121.312229 31.482451,121.312287 31.482181,121.312248 31.481986,121.312015 31.481487,121.311967 31.481358,121.312019 31.481101,121.312306 31.480718,121.312884 31.479996,121.312198 31.479571,121.312441 31.47861,121.312664 31.478602,121.313383 31.479058,121.313602 31.478801,121.314077 31.478087,121.314222 31.477599,121.314277 31.476968,121.314381 31.476646,121.314262 31.476541,121.314165 31.476404,121.31405 31.476295,121.313592 31.476087,121.31318 31.476192,121.312841 31.476295,121.312681 31.476218,121.312612 31.476094,121.312557 31.475746,121.312482 31.475607,121.312258 31.475514,121.312061 31.475501,121.311575 31.475555,121.311369 31.47547,121.309731 31.474294,121.309667 31.474197,121.30969 31.474091,121.309754 31.474009,121.309928 31.473909,121.31171 31.472971,121.311868 31.472852,121.311932 31.472736,121.311936 31.472564,121.3118 31.472065,121.311765 31.471901,121.311825 31.471711,121.312017 31.4715,121.312342 31.471164,121.312778 31.470785,121.313039 31.470475,121.313214 31.470255,121.316104 31.47103,121.316191 31.470633,121.316502 31.470624,121.31656 31.470239,121.315959 31.46921,121.31584 31.468733,121.312616 31.468011,121.312578 31.467962,121.312774 31.46753,121.313182 31.466985,121.313475 31.46656,121.31351 31.466466,121.313469 31.466318,121.313373 31.466228,121.312992 31.466093,121.31289 31.466021,121.31286 31.46594,121.312894 31.465824,121.313099 31.465463,121.313215 31.465018,121.313393 31.464136,121.31488 31.464443,121.314996 31.463614,121.314125 31.463396,121.314345 31.462625,121.313733 31.462537,121.313296 31.462214,121.313335 31.461774,121.313889 31.46131,121.314318 31.46072,121.314588 31.460158,121.315501 31.460407,121.316016 31.459205,121.31418 31.458839,121.315027 31.457272,121.315297 31.456628,121.315539 31.456677,121.315802 31.456713,121.317037 31.456692,121.318442 31.457061,121.319652 31.456925,121.319856 31.456324,121.320314 31.454998,121.320907 31.453413,121.32231 31.453654,121.322763 31.452752,121.322736 31.451966,121.32289 31.451327,121.322726 31.450864,121.322872 31.450578,121.321686 31.450321,121.322773 31.446658,121.323271 31.444837,121.32361 31.443235,121.323944 31.442362,121.324918 31.441873,121.32648 31.442371,121.326842 31.441487,121.329161 31.441946,121.32935 31.441162,121.329213 31.440542,121.329478 31.440081,121.329478 31.439176,121.329989 31.438548,121.33046 31.438037,121.331147 31.437065,121.33141 31.43649,121.331246 31.435308,121.332046 31.433809,121.332188 31.431611,121.331855 31.431515,121.331319 31.431479,121.33087 31.431566,121.330428 31.431444,121.330709 31.431055,121.330784 31.430777,121.330741 31.430575,121.330562 31.429911,121.33053 31.42979,121.33059 31.429419,121.330661 31.429209,121.330986 31.428592,121.331192 31.427995,121.331398 31.427621,121.331546 31.426993,121.333052 31.427134,121.333067 31.42661,121.331685 31.426143,121.332 31.425134,121.332044 31.424935,121.332428 31.424065,121.332535 31.423967,121.332622 31.423483,121.332987 31.422416,121.333026 31.421033,121.332795 31.420887,121.331612 31.420954,121.330983 31.421179,121.330701 31.421342,121.330011 31.421366,121.329972 31.421114,121.329988 31.420277,121.329928 31.419812,121.32956 31.419761,121.329601 31.419033,121.329324 31.418855,121.328891 31.418889,121.327637 31.418688,121.327867 31.418144,121.327745 31.417767,121.327799 31.417511,121.327568 31.417474,121.327568 31.417214,121.328118 31.417239,121.328435 31.417032,121.328874 31.416996,121.328918 31.416858,121.328511 31.416799,121.328781 31.415978,121.329384 31.415962,121.329409 31.41558,121.32799 31.415115,121.328077 31.414569,121.328348 31.413912,121.328584 31.413082,121.328619 31.412543,121.328371 31.412558,121.327441 31.412605,121.326975 31.412484,121.326302 31.412225,121.325787 31.412219,121.325384 31.412324,121.324883 31.412701,121.323887 31.413756,121.311446 31.409703,121.310009 31.409095,121.310932 31.40851,121.310615 31.408374,121.310546 31.408215,121.310721 31.408073,121.310927 31.408053,121.311232 31.4076,121.311613 31.407652,121.312692 31.406016,121.312775 31.40529,121.311667 31.4051,121.311434 31.404947,121.311111 31.404718,121.311083 31.404471,121.311252 31.403296,121.311211 31.402284,121.311181 31.401999,121.31107 31.401812,121.31087 31.401693,121.310361 31.401656,121.310114 31.401535,121.309982 31.401333,121.309959 31.40093,121.310104 31.400454,121.310223 31.400306,121.310596 31.400163,121.31148 31.400112,121.311926 31.399966,121.312363 31.399585,121.312971 31.399251,121.313252 31.399318,121.313947 31.399648,121.314338 31.399687,121.314743 31.399566,121.315525 31.398925,121.31582 31.398862,121.316119 31.399027,121.316579 31.399385,121.316852 31.399445,121.316971 31.399326,121.317035 31.39918,121.316925 31.398792,121.316929 31.398571,121.317136 31.398183,121.31722 31.397792,121.31831 31.397909,121.318368 31.397333,121.318182 31.397116,121.318339 31.396592,121.318846 31.396691,121.318999 31.396284,121.318718 31.396053,121.318858 31.39524,121.318789 31.395096,121.318149 31.394529,121.317914 31.394187,121.317772 31.393613,121.317422 31.393063,121.31709 31.392474,121.316731 31.392049,121.315896 31.391188,121.315857 31.39104,121.315875 31.390918,121.316018 31.390796,121.316308 31.390698,121.3171 31.390572,121.318075 31.390556,121.318457 31.390493,121.318655 31.390364,121.318738 31.390077,121.318678 31.389421,121.318812 31.389142,121.31924 31.388603,121.320101 31.387896,121.320229 31.386898,121.32092 31.386372,121.321132 31.385755,121.321284 31.385511,121.321477 31.385008,121.3215 31.384588,121.321573 31.384297,121.321942 31.383704,121.322049 31.383079,121.323277 31.38343,121.323668 31.382488,121.326031 31.38326,121.32708 31.381583,121.326227 31.381077,121.326654 31.380341,121.325524 31.379582,121.325075 31.379427,121.324264 31.379221,121.324587 31.378654,121.325742 31.377601,121.326107 31.377087,121.326944 31.37614,121.327416 31.376122,121.327995 31.375891,121.328251 31.37558,121.328361 31.375189,121.328463 31.374926,121.328595 31.374865,121.329305 31.374855,121.329574 31.374798,121.329015 31.373378,121.328772 31.373043,121.329501 31.373151,121.329673 31.372473,121.330031 31.372174,121.330481 31.37245,121.330771 31.371876,121.331326 31.3721,121.33144 31.371765,121.331503 31.371499,121.331696 31.37156,121.331917 31.371004,121.331708 31.370947,121.331827 31.370554,121.330168 31.369915,121.330367 31.369125,121.330497 31.368889,121.331109 31.368436,121.331688 31.367572,121.331844 31.367444,121.332124 31.367143,121.332332 31.366919,121.332707 31.366533,121.333175 31.365738,121.333494 31.36526,121.333582 31.364882,121.333657 31.36459,121.333765 31.364421,121.334035 31.364182,121.334282 31.364029,121.334376 31.363912,121.334399 31.363695,121.334331 31.36332,121.334341 31.363142,121.334389 31.362806,121.334542 31.362564,121.334708 31.362483,121.335001 31.362425,121.335268 31.36242,121.335551 31.362442,121.335831 31.362409,121.336023 31.362061,121.336072 31.361797,121.336192 31.361597,121.336521 31.361308,121.336599 31.361155,121.336596 31.361011,121.336456 31.360688,121.336479 31.360557,121.336567 31.360427,121.336879 31.360152,121.337071 31.359882,121.337062 31.359782,121.336964 31.359693,121.336834 31.359643,121.336082 31.359679,121.335652 31.359579,121.335268 31.359407,121.334441 31.358857,121.334331 31.35869,121.334344 31.358365,121.33424 31.358126,121.333582 31.357875,121.333283 31.357898,121.332552 31.357887,121.332621 31.357595,121.332878 31.357118,121.332964 31.356605,121.332814 31.356257,121.332707 31.355872,121.332835 31.355707,121.333157 31.355322,121.333137 31.355253,121.333114 31.355176,121.332921 31.354809,121.332857 31.354553,121.33291 31.354345,121.331783 31.354201,121.331898 31.353576,121.33071 31.353414,121.330725 31.35292,121.330068 31.352916,121.328957 31.353063,121.328081 31.353059,121.328105 31.351578,121.328419 31.351508,121.328412 31.349583,121.32832 31.349566,121.328296 31.34887,121.331725 31.348681,121.332133 31.348699,121.332122 31.348134,121.332142 31.34775,121.332206 31.347317,121.332911 31.347309,121.333082 31.346446,121.333215 31.34629,121.334262 31.346633,121.334677 31.346791,121.33494 31.346101,121.335104 31.346122,121.335266 31.345953,121.335603 31.345263,121.335861 31.34497,121.336269 31.344713,121.33659 31.344347,121.337073 31.344148,121.33732 31.343962,121.337556 31.343394,121.337801 31.343122,121.339792 31.343807,121.341214 31.3392,121.341555 31.338806,121.341713 31.338283,121.341554 31.338194,121.341406 31.338233,121.341062 31.33837,121.340884 31.338473,121.340473 31.338462,121.339887 31.338332,121.339548 31.33803,121.339199 31.338038,121.338525 31.338137,121.338283 31.338122,121.337988 31.337904,121.337881 31.33779,121.337944 31.337172,121.338176 31.336943,121.338306 31.336748,121.33827 31.336431,121.337953 31.336195,121.337841 31.335832,121.337555 31.335588,121.337144 31.335317,121.337037 31.335153,121.337282 31.334916,121.338163 31.334207,121.338587 31.333775,121.338685 31.333478,121.338431 31.333294,121.337747 31.332863,121.337801 31.332642,121.338203 31.332447,121.338909 31.331817,121.338895 31.331753,121.338422 31.331596,121.338417 31.331455,121.339516 31.329871,121.339722 31.329875,121.340075 31.330115,121.340939 31.328802,121.341259 31.3278,121.341375 31.327009,121.342367 31.32723,121.342863 31.326096,121.342751 31.32599,121.342666 31.32591,121.341679 31.325692,121.341667 31.325755,121.341616 31.326013,121.340361 31.325474,121.340396 31.324104,121.340764 31.322769,121.344507 31.32314,121.344402 31.32262,121.344306 31.32226,121.344205 31.322054,121.34413 31.321957,121.344015 31.321878,121.343464 31.321715,121.343298 31.32163,121.34319 31.321543,121.343136 31.321424,121.343113 31.321189,121.343059 31.320923,121.34296 31.320739,121.342819 31.320633,121.342936 31.320294,121.343078 31.319886,121.343165 31.31989,121.343206 31.31961,121.343147 31.31959,121.343287 31.318728,121.342178 31.318231,121.341794 31.318316,121.34116 31.318567,121.340638 31.318794,121.340276 31.318805,121.340141 31.31878,121.34 31.318748,121.339833 31.318739,121.339564 31.3188,121.339356 31.318887,121.339212 31.318975,121.339099 31.31903,121.338936 31.319057,121.338729 31.31907,121.3387 31.318982,121.338675 31.318779,121.33872 31.31838,121.338707 31.318232,121.338642 31.318096,121.338526 31.317973,121.338176 31.317785,121.33805 31.317664,121.337977 31.317537,121.337846 31.317076,121.337711 31.31677,121.337594 31.316623,121.337057 31.31617,121.336957 31.316042,121.336707 31.315481,121.336617 31.315294,121.336504 31.315154,121.336297 31.314953,121.335967 31.314703,121.335836 31.314574,121.33573 31.314432,121.335698 31.314289,121.335791 31.31341,121.335687 31.313158,121.335327 31.312676,121.335174 31.312516,121.334957 31.312383,121.334713 31.312262,121.334516 31.312113,121.334394 31.311949,121.334288 31.311637,121.334241 31.311402,121.334125 31.311095,121.333964 31.310809,121.333741 31.310524,121.333534 31.310282,121.333402 31.310057,121.333311 31.309866,121.33313 31.309036,121.333057 31.308826,121.332956 31.308642,121.332806 31.308487,121.332505 31.308204,121.332316 31.307918,121.332193 31.30756,121.332118 31.307284,121.332079 31.307117,121.331972 31.30694,121.331694 31.3066,121.331565 31.306257,121.331504 31.30606,121.33148 31.305954,121.331475 31.305743,121.331455 31.305615,121.331419 31.30552,121.331345 31.305435,121.331166 31.305362,121.33093 31.305298,121.330617 31.305263,121.330246 31.305251,121.329924 31.305195,121.329678 31.305134,121.329429 31.305029,121.329257 31.304944,121.329021 31.304733,121.328816 31.30457,121.328602 31.304448,121.328472 31.3044,121.328171 31.304289,121.327906 31.304142,121.327731 31.304019,121.327555 31.303862,121.327451 31.30374,121.327301 31.303622,121.327037 31.303501,121.326652 31.303334,121.326442 31.303235,121.328795 31.300369,121.328452 31.300192,121.328121 31.299986,121.329306 31.298573,121.329642 31.297867,121.331568 31.298947,121.331922 31.298367,121.332398 31.298534,121.332873 31.297928,121.332715 31.297812,121.332994 31.297431,121.332722 31.297173,121.331854 31.296819,121.332198 31.296302,121.332409 31.296103,121.332409 31.295851,121.3322 31.295541,121.333351 31.295252,121.333681 31.296048,121.333901 31.296435,121.334596 31.296118,121.335205 31.295764,121.335396 31.295828,121.335573 31.295815,121.335678 31.29572,121.336068 31.29579,121.336421 31.29643,121.336373 31.296572,121.336449 31.29842,121.336361 31.298788,121.336123 31.299246,121.337476 31.299794,121.33757 31.299642,121.337755 31.298997,121.338477 31.299049,121.339217 31.299108,121.339249 31.299121,121.339428 31.299148,121.340352 31.299294,121.342133 31.299491,121.342283 31.299501,121.342337 31.29821,121.34235 31.298215,121.344009 31.298412,121.343971 31.299411,121.344945 31.299385,121.344607 31.300439,121.344117 31.301068,121.344524 31.301123,121.344337 31.301272,121.344455 31.301508,121.344841 31.301902,121.345313 31.302214,121.345829 31.302569,121.345874 31.302589,121.346008 31.302585,121.346362 31.302667,121.346902 31.302785,121.347092 31.302874,121.348036 31.303571,121.348189 31.303594,121.348345 31.303539,121.349458 31.302359,121.350099 31.301736,121.350288 31.301654,121.35045 31.301633,121.350635 31.301661,121.35114 31.302151,121.351832 31.302812,121.352049 31.302962,121.352997 31.30337,121.354299 31.303942,121.355717 31.304569,121.356391 31.304758,121.357472 31.304758,121.358568 31.304622,121.358561 31.304575,121.358498 31.304261,121.357929 31.302583,121.355503 31.296519,121.354634 31.296667,121.353435 31.295474,121.358805 31.293848,121.358761 31.293192,121.361347 31.292847,121.361179 31.292278,121.36491 31.291009,121.36509 31.291306,121.365236 31.29263,121.368292 31.292446,121.368266 31.291105,121.370005 31.290985,121.370154 31.292271,121.371447 31.292228,121.371497 31.292526,121.374237 31.292334,121.374246 31.291683,121.376855 31.291556,121.376878 31.291976,121.376825 31.29278,121.377423 31.292803,121.377441 31.293471,121.376799 31.293516,121.376869 31.293937,121.376869 31.294561,121.378509 31.294613,121.378512 31.295671,121.379858 31.29571,121.379924 31.296274,121.381485 31.296202,121.382691 31.296167,121.382878 31.296031,121.382909 31.296245,121.382887 31.296456,121.383586 31.296399,121.383621 31.296666,121.383595 31.297038,121.384571 31.297011,121.385235 31.296929,121.385429 31.296945,121.386574 31.296721,121.390084 31.296477,121.389565 31.295572,121.389393 31.294922,121.389195 31.293867,121.388894 31.293051,121.39012 31.29287,121.393101 31.292205,121.39269 31.291344,121.3926 31.291012,121.393389 31.290853,121.394786 31.290627,121.394804 31.290229,121.395084 31.290218,121.395051 31.289924,121.394651 31.289375,121.394631 31.289773,121.39449 31.289788,121.394496 31.290164,121.393855 31.290183,121.393692 31.290038,121.393733 31.288856,121.395365 31.288902,121.39556 31.288857,121.39562 31.287944,121.396682 31.287879,121.39968 31.287769,121.399357 31.287286,121.399359 31.286426,121.398007 31.284592,121.397408 31.283753,121.397169 31.28328,121.396788 31.282537,121.395554 31.280423,121.395256 31.279951,121.395716 31.279744,121.395791 31.279218,121.398017 31.278469,121.398346 31.277854,121.398757 31.277762,121.399279 31.277735,121.399837 31.277517,121.40016 31.279041,121.401586 31.278661,121.401831 31.278606,121.401849 31.278069,121.401689 31.277494,121.400919 31.275126,121.400838 31.274878,121.400835 31.274789,121.406271 31.274961,121.405982 31.272369,121.405961 31.272177,121.407785 31.271997,121.408992 31.27155,121.410087 31.271113,121.41065 31.270925,121.411047 31.268248,121.411111 31.267716,121.414184 31.267186,121.414779 31.267083,121.416803 31.268959,121.416743 31.269573,121.415781 31.26952,121.415196 31.269583,121.415205 31.269617,121.415329 31.270081,121.415504 31.270104,121.415836 31.270058,121.41585 31.270417,121.41614 31.270391,121.416155 31.270609,121.416302 31.270635,121.416804 31.270617,121.416807 31.270712,121.416807 31.27073,121.417345 31.270726,121.417343 31.270242,121.418624 31.270251,121.4187 31.270451,121.418858 31.270733,121.419019 31.270898,121.419507 31.271416,121.419684 31.271604,121.420575 31.272455,121.420386 31.272639,121.420111 31.273237,121.420008 31.27358,121.419992 31.274245,121.419871 31.276414,121.419726 31.277545,121.419696 31.27783,121.419939 31.278564,121.420131 31.279063,121.420131 31.279209,121.419941 31.279941,121.419932 31.28017,121.420035 31.280592,121.420048 31.280667,121.41996 31.281482,121.419941 31.281834,121.418892 31.283564,121.418165 31.284771,121.418385 31.28497,121.418462 31.285043,121.418517 31.285172,121.418227 31.286015,121.418216 31.286105,121.418763 31.289219,121.418845 31.290008,121.419029 31.291791,121.419111 31.292725,121.417433 31.29286,121.417446 31.292959,121.417044 31.293029,121.416735 31.293065,121.416483 31.293065,121.414998 31.292876,121.414893 31.293473,121.414214 31.293401,121.414199 31.29404,121.414202 31.294066,121.413965 31.294068,121.413967 31.295801,121.414559 31.295889,121.414302 31.296681,121.414897 31.296701,121.4149 31.29678,121.41499 31.296794,121.414893 31.297116,121.415647 31.297296,121.415746 31.29731,121.415413 31.298724,121.418991 31.299054,121.422325 31.300445,121.42235 31.301107,121.421778 31.304589,121.421773 31.30504,121.425198 31.305301,121.426723 31.305466,121.426358 31.307625,121.426744 31.307652,121.42773 31.307746,121.427116 31.311333,121.427256 31.311393,121.427269 31.311552,121.42736 31.311688,121.42745 31.311782,121.427589 31.311889,121.427755 31.311975,121.427842 31.312069,121.427878 31.312188,121.427872 31.31234,121.427502 31.313503,121.428488 31.313722,121.428427 31.313901,121.429887 31.314325,121.427864 31.320636,121.428055 31.320606,121.428669 31.320523,121.428999 31.32238,121.42905 31.322657,121.431949 31.322655,121.432228 31.321494,121.440021 31.321785,121.44099 31.321865,121.441854 31.322097,121.442914 31.319665,121.4433 31.318776,121.443515 31.31884,121.448332 31.320069,121.448718 31.320261,121.450756 31.321645,121.451177 31.321931,121.452452 31.3228,121.452827 31.322864,121.453986 31.322919,121.4567 31.323038,121.460767 31.323209,121.46074 31.322867,121.460902 31.322564,121.460874 31.322011,121.463395 31.322087,121.463629 31.322098,121.463889 31.320024,121.463779 31.317882,121.467867 31.317638,121.469881 31.317408,121.473714 31.316798,121.473851 31.316543,121.474097 31.31641,121.474183 31.316374,121.474324 31.316429,121.474419 31.316465,121.474641 31.316642,121.474795 31.31661,121.480673 31.316726,121.480766 31.316721,121.480856 31.316667,121.480882 31.316634,121.480887 31.31657,121.48091 31.315998,121.480907 31.313476,121.491632 31.313444,121.492211 31.313454,121.492062 31.316412,121.491912 31.31874,121.491762 31.322635,121.4917 31.324887,121.491687 31.325348,121.49173 31.325494,121.491848 31.325586,121.492032 31.325648,121.492354 31.325801,121.492589 31.325904,121.492757 31.325989,121.492971 31.326128,121.493401 31.326561,121.493693 31.326794,121.494453 31.327217,121.49449 31.327288,121.494529 31.327375,121.494497 31.327559,121.49446 31.32767,121.494249 31.32814,121.493529 31.329357,121.493292 31.329816,121.493071 31.33006,121.492492 31.330355,121.490791 31.331277,121.489211 31.332133,121.48915 31.332293,121.489149 31.33243,121.489291 31.332674,121.489286 31.332762,121.489254 31.332844,121.489262 31.332855,121.489673 31.333312,121.490212 31.333956,121.492014 31.33628,121.495924 31.34127,121.497195 31.342866,121.499585 31.345954,121.501198 31.348043,121.504473 31.346633,121.504658 31.346553,121.506682 31.345732,121.50917 31.344698,121.513273 31.342787,121.513622 31.343114,121.515165 31.344837,121.51592 31.34568,121.517 31.34521,121.51847 31.344558,121.518676 31.344936,121.521051 31.349096,121.517218 31.350951,121.512436 31.353704,121.505467 31.358037,121.502767 31.36053,121.501627 31.362012,121.500663 31.364138,121.500163 31.365089,121.499242 31.369184,121.499268 31.373121,121.500277 31.377642,121.501364 31.380906,121.504772 31.385273,121.510241 31.389633,121.511889 31.390702,121.514319 31.391225,121.526984 31.399434,121.55662 31.416776,121.542592 31.424626,121.535167 31.431858,121.520791 31.453973,121.510749 31.462722,121.4562 31.502012,121.417856 31.523013,121.382253 31.547076,121.344101 31.519414,121.337363 31.51456,121.331958 31.510622,121.331559 31.510331,121.325294 31.506347,121.324969 31.506182,121.324773 31.506009,121.324165 31.505832,121.323975 31.50653,121.323754 31.506521,121.322273 31.506259,121.322545 31.505337,121.321133 31.504964,121.320843 31.506121,121.31997 31.505973,121.320235 31.504802,121.318419 31.5044,121.318454 31.504148,121.318602 31.503397,121.318765 31.502876,121.31918 31.501381,121.31884 31.501299,121.318704 31.50129,121.317936 31.501293,121.317833 31.502,121.317047 31.501938,121.317132 31.501263,121.317022 31.501241,121.316175 31.501091,121.31595 31.501073,121.31585 31.501606,121.315437 31.501552,121.315268 31.502384,121.315258 31.502557,121.315262 31.50274,121.3153 31.502868,121.315372 31.50308,121.31541 31.50325,121.315501 31.503934,121.315488 31.504425,121.315414 31.50477,121.316378 31.504926,121.316367 31.505001,121.317598 31.505192,121.317445 31.505724,121.317274 31.505712,121.317176 31.506183,121.316653 31.506113,121.316141 31.506034,121.316029 31.506917,121.315433 31.506904,121.315423 31.507114,121.315455 31.507208,121.315509 31.507277,121.315573 31.507352,121.3156 31.507405,121.315614 31.507476,121.315611 31.50752,121.315598 31.50756,121.315549 31.507634,121.31553 31.507696,121.315527 31.507752,121.315535 31.507845,121.312244 31.507713,121.31211 31.507581,121.312049 31.507512,121.312014 31.507423,121.311981 31.507273,121.311993 31.507108,121.311797 31.50705,121.31197 31.506184,121.312158 31.506192,121.312105 31.505758,121.312071 31.505564,121.31203 31.505404,121.311913 31.505139,121.311773 31.504819,121.31146 31.504154,121.311028 31.503445,121.310796 31.50306,121.31058 31.502974,121.309008 31.502562,121.308697 31.503594,121.309171 31.503721,121.309049 31.504109,121.308609 31.504006,121.308414 31.504638,121.30756 31.504432,121.307537 31.504689,121.307489 31.504901,121.307457 31.505015,121.307406 31.505157,121.307339 31.505388,121.307243 31.505505,121.307151 31.505591,121.307062 31.50573,121.307545 31.505871,121.30747 31.506142,121.307454 31.506239,121.307461 31.506272,121.307513 31.506305,121.307376 31.506769,121.30673 31.506597,121.306596 31.50671,121.306567 31.506753,121.30655 31.506792,121.306543 31.506833,121.306536 31.506903,121.30653 31.506949,121.30651 31.507002,121.306464 31.507068,121.306384 31.507208,121.30634 31.507269,121.306231 31.507347,121.306198 31.507389,121.30618 31.507431,121.306179 31.507488,121.306204 31.507632,121.306208 31.507818,121.304977 31.507485,121.304858 31.507579,121.304013 31.507203,121.304375 31.506598,121.303872 31.506387,121.303636 31.506841,121.30329 31.507426,121.303117 31.507347,121.30305 31.507302,121.302974 31.507175,121.302906 31.507115,121.302793 31.507048,121.302699 31.506973,121.302566 31.506857,121.302454 31.506788,121.302368 31.506766,121.301956 31.507355,121.301313 31.507082,121.301208 31.507174,121.300917 31.507689,121.300557 31.507519,121.300954 31.506795,121.300559 31.506596,121.301308 31.5055,121.301266 31.505459,121.301232 31.505401,121.301186 31.505312,121.30109 31.505219,121.300966 31.505127,121.3008 31.505031,121.30054 31.504903,121.30006 31.504721,121.300017 31.504677,121.300002 31.504623,121.300003 31.504565,121.300181 31.504168,121.300163 31.504112,121.300125 31.504075,121.300065 31.504039,121.299229 31.503716,121.298921 31.504246,121.298879 31.50429,121.298826 31.50431,121.298764 31.504313,121.298403 31.504228,121.298209 31.504654,121.297641 31.504477,121.297832 31.504007,121.297857 31.503945,121.297726 31.503905,121.296474 31.503524,121.29687 31.50284,121.297144 31.502431,121.297385 31.502226,121.297527 31.502076,121.29788 31.501471,121.297788 31.501016,121.297702 31.500997,121.297565 31.501009,121.297444 31.501043,121.297377 31.501086,121.297315 31.501149,121.296531 31.502299,121.295578 31.501753
    </textarea>
    <button type="button" onclick="buildGeoHashs()" style="margin-top: 5px;width: 99px">生成GeoHash</button>

    <textarea id="fenceGeo" style="margin-top: 5px;width: 94px" placeholder="围栏内GeoHash"></textarea>
    <textarea id="fenceGeoZip" style="margin-top: 5px;width: 94px" placeholder="围栏内GeoHash压缩数据"></textarea>

</div>
<script>
    $('#select').bind('input propertychange', function () {
        var val = $('#select').val();
        if (val === "1") {
            showGaodeMap()
        }
        if (val === "2") {
            showGoogleMap()
        }
        if (val === "3") {
            showOsmMap()
        }
        if (val === "4") {
            showGoogleWXMap()
        }
        if (val === "5") {
            showTerrainMap()

        }
    });


    var map = L.map('map', {
        center: [39.905530, 116.391305],
        zoom: 4,
        crs: L.CRS.EPSG3857,
        layers: []
    });


    //添加高德地图
    var gaodeMap = L.tileLayer.chinaProvider('GaoDe.Normal.Map').addTo(map);
    var googleMap = L.tileLayer.chinaProvider('Google.Normal.Map').addTo(map);
    var osmMap = L.tileLayer.chinaProvider('OSM.Normal.Map').addTo(map);
    var googleWxMap = L.tileLayer.chinaProvider('Google.Satellite.Map').addTo(map);
    var terrainMap = L.tileLayer.chinaProvider('TERRAIN.Normal.Map').addTo(map);
    map.on("click", function (evt) {
        dumpPoints();
    });

    function showGaodeMap() {
        clear()
        gaodeMap.setOpacity(1)
        document.getElementById('map').style.visibility = ''
    }

    function showGoogleMap() {
        clear()
        googleMap.setOpacity(1)
        document.getElementById('map').style.visibility = ''

    }

    function showGoogleWXMap() {
        clear()
        googleWxMap.setOpacity(1)
        document.getElementById('map').style.visibility = ''
    }

    function showTerrainMap() {
        clear()
        terrainMap.setOpacity(1)
        document.getElementById('map').style.visibility = ''
    }

    function showOsmMap() {
        clear()
        osmMap.setOpacity(1)
        document.getElementById('map').style.visibility = ''
    }

    function clear() {
        gaodeMap.setOpacity(0)
        googleMap.setOpacity(0)
        osmMap.setOpacity(0)
        googleWxMap.setOpacity(0)
        terrainMap.setOpacity(0)

        document.getElementById('map').style.visibility = 'hidden'
    }

    //定义一个比例尺控件
    var scale = L.control.scale();
    //将比例尺控件加载到地图容器中
    map.addControl(scale);
    //获取Attribution控件
    attribution = map.attributionControl;
    //替换默认的leaflet前缀改为自定义的logo和文字
    attribution.setPrefix('');
    attribution.addAttribution("GCJ-02");


    showGaodeMap();



    var drawLayers = [];

    function drawRectangle(boundsList, geos, geo7Count) {
        for (let i = 0; i < boundsList.length; i++) {
            // 矩形：坐标点 [[ymin, xmin], [ymax, xmax]]
            var bounds = boundsList[i];
            // 绘制且添加
            var rectangle = L.rectangle(bounds, {color: "#ff7800", weight: 1, fill: false}).addTo(map);
            drawLayers.push(rectangle);
            if (geo7Count < 200 && geos[i].length < 8) {
                rectangle.bindTooltip(geos[i]).openTooltip();
            }
            // 跳到矩形的范围
            //  map.fitBounds(rectangle.getBounds());
        }
    }



    function drawSpilt(boundsList) {
        for (let i = 0; i < boundsList.length; i++) {
            // 矩形：坐标点 [[ymin, xmin], [ymax, xmax]]
            var bounds = boundsList[i];
            // 绘制且添加
            var rectangle = L.rectangle(bounds, {color: "#0000ff", weight: 1, fill: false}).addTo(map);
            drawLayers.push(rectangle);

            // 跳到矩形的范围
            //  map.fitBounds(rectangle.getBounds());
        }
    }

    //缩放监听   当zoom>=10的时候再显示本图层。
    map.on('zoomend', function (e) {
        showGeoHashs();
    });
    //地图级别改变时发生
    map.on("zoomend", function (e) {
        showGeoHashs();

    });
    //拖动地图时发生
    map.on("moveend", function (e) {
        showGeoHashs();
    });
    //////////////////////////////绘制围栏///////////////////////////////////////////////////////////
    function buildGeoHashs() {
        var val = $("#fenceSetting").val();
        if (val===''){
            var fenceGeo = $("#fenceGeo").val();
            var fenceGeoZip = $("#fenceGeoZip").val();
            if (fenceGeo==='' && fenceGeoZip!==''){
                NProgress.start();
                $.ajax({
                    type: "POST",
                    url: "/geo-region/fenceGeoZip/2/fenceGeo",
                    contentType: "application/json",
                    dataType: "json",
                    data:JSON.stringify({
                        fenceGeoZip:fenceGeoZip
                    }),
                    success: function (data) {
                        NProgress.done();

                        if (data){
                            $("#fenceGeo").val(data.allArea);
                            showGeoHashs()
                        }

                    }
                })
            } else if (fenceGeo!=='') {
                showGeoHashs()
            } else {
                alert("围栏坐标或GeoHash数据不能为空");
            }

            return;
        }
        var split = val.split(",");
        split.push(split[0]);
        val = split.join(",");
        $("#fenceSetting").val(val);
        reflushFence();
        NProgress.start();

        $.ajax({
            type: "POST",
            url: "/geo-region/build/area",
            contentType: "application/json",
            dataType: "json",
            data:JSON.stringify({
                setting:val
            }),
            success: function (data) {
                NProgress.done();

                if (data){
                    $("#fenceGeo").val(data.allArea);
                    $("#fenceGeoZip").val(data.zipArea);
                    showGeoHashs()
                }

            }
        })
    }

    function showGeoHashs() {

        if ($("#fenceGeo").val()){
            var min = map.getBounds().getSouthWest();
            var max = map.getBounds().getNorthEast();
            NProgress.start();

            $.ajax({
                type: "POST",
                url: "/geo-region/show/area?lngStart=" + min.lng + "&lngEnd=" + max.lng + "&latStart=" + min.lat + "&latEnd=" + max.lat,
                contentType: "application/json",
                dataType: "json",
                data:JSON.stringify({
                    geos:$("#fenceGeo").val()
                }),
                success: function (data) {
                    NProgress.done();
                    if (data){
                        cleanDraw();
                        drawRectangle(data.data, data.geos, data.geo7Count)
                    }

                }
            })
        }
    }


    // var settings = "121.7821 28.9854,122.0347 29.0911,122.1084 29.5630,122.7909 30.0950,122.4271 30.3298,121.3381 30.4633,121.4251 30.6250,122.0561 30.8697,122.0551 31.2888,122.0411 31.7536,121.4048 32.4335,120.7467 33.4248,120.2993 34.3128,119.7315 34.5711,119.5128 34.7550,119.4466 34.7844,119.3258 34.7790,119.2516 34.8109,119.2136 34.8856,119.2391 35.0435";
    var polylineEditor = false;
    function reflushFence() {

        if (polylineEditor) {
            map.getEditablePolylines().forEach(function (polyline) {
                map.removeLayer(polyline)
            })
        }

        var settings = $("#fenceSetting").val();
        var coordinates = [];
        var lngLats = settings.split(",");
        for (let i = 0; i < lngLats.length; i++) {
            var LngLat = lngLats[i].split(" ");
            coordinates.push([LngLat[1], LngLat[0]])
        }

        var polyline = L.Polyline.PolylineEditor(coordinates, {maxMarkers: 500}).addTo(map);
        polylineEditor=true;
        map.fitBounds(polyline.getBounds());
    }

    function dumpPoints() {
        let setting = [];
        map.getEditablePolylines().forEach(function (polyline) {
            var points = polyline.getPoints();
            points.forEach(function (point) {
                var latLng = point.getLatLng();
                setting.push(latLng.lng.toFixed(4) + ' ' + latLng.lat.toFixed(4));
            });
        });
        var data = setting.join(",");
        $("#fenceSetting").val(data);
        console.log(data);
    };

    //////////////////////////////绘制围栏///////////////////////////////////////////////////////////


    function drawPolygon(latlngs) {
        // 多边形：坐标点，注意 第一个 与 最后一个点是无需一样，会自动闭合
        /*        var latlngs = [
                    [31.537628173828125,121.190185546875],
                    [30.878448486328125,121.19430541992188],
                    [30.839996337890625,121.92901611328125],
                    [31.348114013671875,121.8878173828125]
                ];*/
        var polygon = L.polygon(latlngs, {color: 'red', fill: false}).addTo(map);
        drawLayers.push(polygon);
        // 跳到多边形的范围
        //map.fitBounds(polygon.getBounds());
    }

    //执行清除方法
    function cleanDraw() {
        for (var i = 0; i < drawLayers.length; i++) {
            //移除图层
            map.removeLayer(drawLayers[i]);
        }
        //清空数组
        drawLayers = [];

    }


    ///////////////////////////////////////////测距/////////////////////////////////////////////
    var DRAWING = false; //是否正在绘制
    var BarDRAWLAYERS = [];
    var markerDistance;

    var MEASURETOOLTIP; //量距提示
    var MEASURERESULT = 0; //测量结果

    var DRAWMOVEPOLYLINE; //绘制过程中的折线
    var DRAWPOLYLINEPOINTS = []; //绘制的折线的节点集

    $('#juliMeasure').click(function () {
        //开始画线
        startDrawLine();
    });

    function startDrawLine() {
        MEASURERESULT = 0; //测量结果
        map.getContainer().style.cursor = 'crosshair';
        var shapeOptions = {
                color: '#F54124',
                weight: 3,
                opacity: 0.8,
                fill: false,
                clickable: true
            },
            //绘制的折线
            DRAWPOLYLINE = new L.Polyline([], shapeOptions);
        //地图上添加折线
        map.addLayer(DRAWPOLYLINE);
        //实例化量距提示
        MEASURETOOLTIP = new L.Tooltip(map);
        //设置地图的鼠标按下事件
        map.on('mousedown', onClick);
        //设置地图的双击事件
        map.on('dblclick', onDoubleClick);

        //鼠标按下事件
        function onClick(e) {
            DRAWING = true; //是否正在绘制
            DRAWPOLYLINEPOINTS.push(e.latlng); //绘制的折线的节点集
            //测量结果加上距离上个点的距离
            MEASURERESULT += e.latlng.distanceTo(DRAWPOLYLINEPOINTS[DRAWPOLYLINEPOINTS.length - 2]);
            //绘制的折线添加进集合
            DRAWPOLYLINE.addLatLng(e.latlng);
            //地图添加鼠标移动事件
            map.on('mousemove', onMove);
        }

        //鼠标移动事件
        function onMove(e) {
            if (DRAWING) { //是否正在绘制
                //将上次的移除
                if (DRAWMOVEPOLYLINE != undefined && DRAWMOVEPOLYLINE != null) { //绘制过程中的折线
                    map.removeLayer(DRAWMOVEPOLYLINE);
                }
                //获取上个点坐标
                var prevPoint = DRAWPOLYLINEPOINTS[DRAWPOLYLINEPOINTS.length - 1];
                //绘制最后一次的折线
                DRAWMOVEPOLYLINE = new L.Polyline([prevPoint, e.latlng], shapeOptions);
                //添加到地图
                map.addLayer(DRAWMOVEPOLYLINE);
                //累加距离
                var distance = MEASURERESULT + e.latlng.distanceTo(DRAWPOLYLINEPOINTS[DRAWPOLYLINEPOINTS
                    .length - 1]);
            }
        }

        //鼠标双击事件
        function onDoubleClick(e) {
            map.getContainer().style.cursor = '';
            /*显示两点距离*/
            //之前的距离加上最后一次的距离
            var distance = MEASURERESULT + e.latlng.distanceTo(DRAWPOLYLINEPOINTS[DRAWPOLYLINEPOINTS.length -
            1]);
            //添加一个标记
            markerDistance = new L.Marker(e.latlng, {
                draggable: false
            });
            //地图上添加标记
            map.addLayer(markerDistance);
            //标记绑定弹窗显示
            markerDistance.bindPopup((distance / 1000).toFixed(2) + "KM").openPopup();
            if (DRAWING) {
                //清除上次的
                if (DRAWMOVEPOLYLINE != undefined && DRAWMOVEPOLYLINE != null) {
                    map.removeLayer(DRAWMOVEPOLYLINE);
                    DRAWMOVEPOLYLINE = null;
                }
                BarDRAWLAYERS.push(DRAWPOLYLINE);
                DRAWPOLYLINEPOINTS = [];
                DRAWING = false;
                //移除事件
                map.off('mousedown');
                map.off('mousemove');
                map.off('dblclick');
            }
        }

    }


    //清除按钮点击事件
    $('#clearMeasure').click(function () {
        qingchu()
    })

    //执行清除方法
    function qingchu(func) {
        for (var i = 0; i < BarDRAWLAYERS.length; i++) {
            //移除图层
            map.removeLayer(BarDRAWLAYERS[i]);
        }
        //清空数组
        BarDRAWLAYERS = [];
        if (markerDistance) {
            map.removeLayer(markerDistance)
        }
    }

    function WGS84ToMercator(wgs84Point){
        const earthRad = 6378137.0; //地球半径
        let lng = wgs84Point.lng * Math.PI / 180 * earthRad;
        const param = wgs84Point.lat * Math.PI / 180;
        let lat = earthRad / 2 * Math.log((1.0 + Math.sin(param)) / (1.0 - Math.sin(param)));
        let mercator={x:lng,y:lat};
        return /*toLatLng(lat, lng, map)*/mercator;
    }

    function MercatorToWGS84(mctPoint){
        mctPoint = lngLat2Mercator(mctPoint);
        const lng = mctPoint.lng / 20037508.34 * 180;
        let lat = mctPoint.lat / 20037508.34 * 180;
        lat = 180 / Math.PI * (2 * Math.atan(Math.exp(lat * Math.PI / 180)) - Math.PI / 2);
        return {lng:lng,lat:lat};
    }
    console.log()
    console.log(WGS84ToMercator({lng:120,lat:30}));

    function toLatLng(x, y, map) {
        const projected = L.point(y, x)/*.divideBy(6378137)*/;
        return map.options.crs.projection.unproject(projected);
    }
    function lngLat2Mercator(lngLat){
        const mercator = {};

        let x = lngLat.lng * 20037508.34 / 180;
        let y = Math.log(Math.tan((90 + lngLat.lat) * Math.PI / 360)) / (Math.PI / 180);

        y = y * 20037508.34 / 180;

        mercator.lng = x;
        mercator.lat = y;

        return mercator;
    }

</script>
</body>

</html>